# make.inc template.
SHELL := /bin/bash
#
OSXVER := 10.11
GCCVER := mp-6
MACPORT :=/opt/local
COMPILERBIN := $(MACPORT)/bin
INSTALL_DIR := /usr/local
LIBNAME := libxblas

#  **********   WARNING   ******************
# Don't fuck with anything below unless you know what you are doing

BINDIR := $(INSTALL_DIR)/bin
LIBDIR := $(INSTALL_DIR)/lib
INCDIR := $(INSTALL_DIR)/include
$(shell if [[ ! -d $(LIBDIR) ]]; then $(MKDIR) $(BINDIR); fi)
$(shell if [[ ! -d $(LIBDIR) ]]; then $(MKDIR) $(LIBDIR); fi)
$(shell if [[ ! -d $(INCDIR) ]]; then $(MKDIR) $(INCDIR); fi)

# The name of the libraries to be created/linked to
LIBSTATIC := $(LIBNAME).a
LIBSHARED := $(LIBNAME).dylib
SHAREDFLAGS := -dead_strip -dynamiclib -flat_namespace \
-compatibility_version 1.0.0 -current_version 1.0.0 -fno-common

# CC is the C compiler, normally invoked with options CFLAGS.
FC  := $(COMPILERBIN)/gfortran-$(GCCVER)
F77 := $(FC)
CC  := $(COMPILERBIN)/gcc-$(GCCVER)
CXX := $(COMPILERBIN)/g++-$(GCCVER)
CPP := "$(COMPILERBIN)/gcc-$(GCCVER) -E"
LD  := $(COMPILERBIN)/ld
AS  := $(COMPILERBIN)/gcc-as-$(GCCVER)
NM  := $(COMPILERBIN)/gcc-nm-$(GCCVER)
OTOOL :=  $(COMPILERBIN)/otool -L
#use system not macports not homebrew
AR     := /usr/bin/ar
RANLIB := /usr/bin/ar -s
CP     := /bin/cp -fR
LN     := /bin/ln -s
MKDIR  := /bin/mkdir -p
NUKE   := /bin/rm -fR
FIND   := /usr/bin/find

# For gfortran
F2C_CONFIG := -DCONFIG_FC_UNDERSCORE
# For g77 or gfortran -ff2c
#F2C_CONFIG=-DCONFIG_FC_DBL_UNDERSCORE -DCONFIG_FC_RETURNS_DBL_REAL

# SIMDFLAGS := -mavx2 -mfma -mfpmath=sse -msse2 -msse3 -msse4.1 -msse4.2
SIMDFLAGS := -mfpmath=sse -msse2 -msse3 -msse4.1 -msse4.2 \
-msse2avx -mno-avx

CFLAGS := -O3 -arch x86_64 -pipe -m64 -mtune=native -march=native \
-mmacosx-version-min=$(OSXVER) -fomit-frame-pointer -fno-common -funroll-loops \
-mpreferred-stack-boundary=4

CFLAGS += $(SIMDFLAGS) $(F2C_CONFIG) -DHAVE_FPU_CONTROL_H -std=c11

# LINKER and LDFLAGS function as CC and CFLAGS, but for linking stages.
LINKER := $(CC)
LDFLAGS := $(CFLAGS)

# The archiver and the flag(s) to use when building archive (library)
ARCH      := $(AR)
ARCHFLAGS := -rcs

# Extra libraries needed for xblas test code.
EXTRA_LIBS :=  -lm -lpthread -framework Accelerate

# Indent program.  Used to prettify C source generated by M4.
INDENT	= indent
INDENT_OPTS =  -ce -i2 -nfc1 -br -brs -npsl
# INDENT_OPTS=-nbad -bap -nbc -bbo -hnl -br -brs -c33 -cd33 \
# -ncdb -ce -ci4 -cli0 -d0 -di1 -nfc1 -i8 -ip0 -l80 \
# -lp -npcs -nprs -npsl -sai \
# -saf -saw -ncs -nsc -sob -nfca -cp33 -ss -ts8
red    :="\033[0;31m"
RED    :="\033[1;31m"
green  :="\033[0;32m"
GREEN  :="\033[1;32m"
yellow :="\033[0;33m"
YELLOW :="\033[1;33m"
blue   :="\033[0;34m"
BLUE   :="\033[1;34m"
purple :="\033[0;35m"
PURPLE :="\033[1;35m"
cyan   :="\033[0;36m"
CYAN   :="\033[1;36m"
black  :="\033[0;30m"
BLACK  :="\033[1;30m"
NC     :="\033[0m"
